enum SwarmMode {
    manager
    worker
}

enum ProxyType {
    backup
    active
}

enum ServerStatus {
    needs_setup
    preparing
    online
    offline
}

enum ServerResourceAnalyticsTimeframe {
    last_1_hour
    last_3_hours
    last_6_hours
    last_12_hours
    last_24_hours
    last_7_days
    last_30_days
}

input NewServerInput {
    ip: String!
    ssh_port: Int!
    user: String!
}

type Server {
    id: Uint!
    ip: String!
    hostname: String!
    user: String!
    ssh_port: Int!
    swarmMode: SwarmMode!
    swarmNodeStatus: String!
    scheduleDeployments: Boolean!
    maintenanceMode: Boolean!
    dockerUnixSocketPath: String!
    proxyEnabled: Boolean!
    proxyType: ProxyType!
    status: ServerStatus!
    logs: [ServerLog!]!
}

input ServerSetupInput {
    id: Uint!
    dockerUnixSocketPath: String!
    advertiseIP: String!
    swarmMode: SwarmMode!
}

type Dependency {
    name: String!
    available: Boolean!
}

type ServerResourceAnalytics {
    cpu_usage_percent: Int!
    memory_total_gb: Float!
    memory_used_gb: Float!
    memory_cached_gb: Float!
    network_sent_kb: Uint64!
    network_recv_kb: Uint64!
    network_sent_kbps: Uint64!
    network_recv_kbps: Uint64!
    timestamp: Time!
}

type ServerDiskUsage {
    path: String!
    mount_point: String!
    total_gb: Float!
    used_gb: Float!
    timestamp: Time!
}

type ServerDisksUsage {
    disks: [ServerDiskUsage!]!
    timestamp: Time!
}

type NetworkInterface {
    name: String!
    ip: String!
}

extend type Query {
    noOfServers: Int! @isAuthenticated
    noOfPreparedServers: Int! @isAuthenticated
    servers: [Server!] @isAuthenticated
    server(id: Uint!): Server! @isAuthenticated
    publicSSHKey: String! @isAuthenticated
    serverResourceAnalytics(id: Uint!, timeframe: ServerResourceAnalyticsTimeframe!): [ServerResourceAnalytics!]! @isAuthenticated
    serverDiskUsage(id: Uint!): [ServerDisksUsage!]! @isAuthenticated # return last 1000 records
    serverLatestResourceAnalytics(id: Uint!): ServerResourceAnalytics! @isAuthenticated
    serverLatestDiskUsage(id: Uint!): ServerDisksUsage! @isAuthenticated
    networkInterfacesOnServer(id: Uint!): [NetworkInterface!]! @isAuthenticated
}

extend type Mutation {
    createServer(input: NewServerInput!): Server! @isAuthenticated
    deleteServer(id: Uint!): Boolean! @isAuthenticated
    testSSHAccessToServer(id: Uint!): Boolean! @isAuthenticated
    checkDependenciesOnServer(id: Uint!): [Dependency!] @isAuthenticated
    installDependenciesOnServer(id: Uint!): Boolean! @isAuthenticated
    setupServer(input: ServerSetupInput!): Boolean! @isAuthenticated
    promoteServerToManager(id: Uint!): Boolean! @isAuthenticated
    demoteServerToWorker(id: Uint!): Boolean! @isAuthenticated
    restrictDeploymentOnServer(id: Uint!): Boolean! @isAuthenticated
    allowDeploymentOnServer(id: Uint!): Boolean! @isAuthenticated
    putServerInMaintenanceMode(id: Uint!): Boolean! @isAuthenticated
    putServerOutOfMaintenanceMode(id: Uint!): Boolean! @isAuthenticated
    removeServerFromSwarmCluster(id: Uint!): Boolean! @isAuthenticated
    enableProxyOnServer(id: Uint!, type: ProxyType!): Boolean! @isAuthenticated
    disableProxyOnServer(id: Uint!): Boolean! @isAuthenticated
    fetchAnalyticsServiceToken(id: Uint!, rotate:Boolean!): String! @isAuthenticated
    changeServerIpAddress(id: Uint!, ip: String!): Boolean! @isAuthenticated
    changeServerSSHPort(id: Uint!, port: Int!): Boolean! @isAuthenticated
}